<html>
    <head>
        <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/body-pix@2.0"></script>
        <style>
            img, video { object-fit:cover }
        </style>
    </head>
    <body>
        <video autoplay playsinline muted id="image" width="300" height="300"></video>
        <canvas id="ylf" width="300" height="300"></canvas>
        <script>
            
        async function setupimage() {
            return new Promise( ( resolve, reject ) => {
                const imageElement = document.getElementById( "image" );
                const navigatorAny = navigator;
                if( navigator.getUserMedia ) {
                    navigator.getUserMedia( 
                        { video: true },
                        stream => {
                            imageElement.srcObject = stream;
                            imageElement.addEventListener( 'loadeddata', resolve, false );
                        },
                        error => reject()
                    );
                }
                else {
                    reject();
                }
            });
        }
 
        (async () => {
            model = await bodyPix.load({
                architecture: 'MobileNetV1',  
                outputStride: 16,
                multiplier: 0.5,     
                quantBytes: 2
            });
            await setupimage();
            setInterval( predictImage, 300);
        })();
 
        async function predictImage() {
            const img = document.getElementById( "image" );
            const segmentation = await model.segmentMultiPersonParts( img );     //多人人体分割       
            const ylf = document.getElementById( "ylf");
            const coloredPartImage = bodyPix.toColoredPartMask(segmentation);
            const opacity = 0.7;
            const flipHorizontal = false;
            const maskBlurAmount = 0;
            const pixelCellWidth = 8.0;    
            /*
            bodyPix.drawPixelatedMask(
                ylf, img, coloredPartImage, opacity, maskBlurAmount,
                flipHorizontal, pixelCellWidth);
            */
            bodyPix.drawMask(
                ylf, img, coloredPartImage, opacity, maskBlurAmount,
                flipHorizontal, );//这个好看一些
                
        }
        </script>
    </body>
</html>
